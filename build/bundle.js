(()=>{"use strict";const e="beforebegin",t="afterbegin",n="beforeend",l="afterend",s=e=>{const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},r=function(s,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n;const a=s.getElement();switch(o){case e:r.before(a);break;case t:r.prepend(a);break;case n:r.append(a);break;case l:r.after(a)}};class o{getTemplate(){return'<div class="border-size">\n    <button class="size-btn" data-size="4">2x2</button>\n    <button class="size-btn" data-size="9">3x3</button>\n    <button class="size-btn active-size" data-size="16">4x4</button>\n    <button class="size-btn" data-size="25">5x5</button>\n    <button class="size-btn" data-size="36">6x6</button>\n    <button class="size-btn" data-size="49">7x7</button>\n    <button class="size-btn" data-size="64">8x8</button>\n  </div>'}getElement(){return this.element||(this.element=s(this.getTemplate())),this.element}removeElement(){this.element=null}}class a{getTemplate(){return'<div class="leasers">\n    <h3>Лучшие результаты среди всех полей:</h3>\n    <table class="score-list">\n    <tr>\n      <th>Место&nbsp;&nbsp;</th>\n      <th>&nbsp;&nbsp;&nbsp;Количество ходов</th>\n    </tr>\n    <tr>\n      <td>1</td>\n      <td data-td></td>\n    </tr>\n    <tr>\n      <td>2</td>\n      <td data-td></td>\n    </tr>\n    <tr>\n      <td>3</td>\n      <td data-td></td>\n    </tr>\n    <tr>\n      <td>4</td>\n      <td data-td></td>\n    </tr>\n    <tr>\n      <td>5</td>\n      <td data-td></td>\n    </tr>\n    <tr>\n      <td>6</td>\n      <td data-td></td>\n    </tr>\n    <tr>\n      <td>7</td>\n      <td data-td></td>\n    </tr>\n    <tr>\n      <td>8</td>\n      <td data-td></td>\n    </tr>\n    <tr>\n      <td>9</td>\n      <td data-td></td>\n    </tr>\n    <tr>\n      <td>10</td>\n      <td data-td></td>\n    </tr>\n    </table>\n  </div>'}getElement(){return this.element||(this.element=s(this.getTemplate())),this.element}removeElement(){this.element=null}}const i=(e,t)=>`<button class="puzzle-item puzzle-item-${t}" data-number="${e}">${e}</button>`;class d{getTemplate(){return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;const t=Number(e);let n=[];for(let l=1;l<=t;l++)n.push(i(l,e));return`<div class="puzzle-list">\n    ${n.join("")}\n  </div>`}()}getElement(){return this.element||(this.element=s(this.getTemplate())),this.element}removeElement(){this.element=null}updateElement(e){return(e=>{const t=document.querySelector(".puzzle-list");t.innerHTML="";for(let n=1;n<=e;n++){const l=s(i(n,e));t.append(l)}})(e)}}class c{getTemplate(){return'<div class="setting-buttons">\n    <button class="setting-item one">Shuffle and start (or restart)</button>\n    <button class="setting-item two">Продолжить игру</button>\n  </div>'}getElement(){return this.element||(this.element=s(this.getTemplate())),this.element}removeElement(){this.element=null}}class u{getTemplate(){return'<div class="stats">\n    <div class="time">00:00</div>\n    <div class="move">Ходов: <span class="move-value">0</span></div>\n  </div>'}getElement(){return this.element||(this.element=s(this.getTemplate())),this.element}removeElement(){this.element=null}}class m{getTemplate(){return'<div class="winning-message">\n    <div class="winText">Hooray! You solved the puzzle in ##:## and N moves!</div>\n    <button class="restartButton">Новая игра</button>\n  </div>'}getElement(){return this.element||(this.element=s(this.getTemplate())),this.element}removeElement(){this.element=null}}class g{getTemplate(){return'<div class="music-box">\n    <input type="checkbox" id="music" name="scales">\n    <label for="music">Звук движения плитки</label>\n  </div>'}getElement(){return this.element||(this.element=s(this.getTemplate())),this.element}removeElement(){this.element=null}}const h=()=>JSON.parse(localStorage.getItem("saveWinList"));let b,v,p,f;f=null!==h()?h():[];const S=e=>{let t=e.map((e=>Number(e.dataset.number))),n=Math.sqrt(e.length),l=Array(n).fill(0).map((e=>[]));const s=l.length;let r=0,o=0;for(let e=0;e<t.length;e++)r===s&&(o+=1,r=0),l[o][r]=t[e],r+=1;return l},y=(e,t)=>{for(let n=0;n<e.length;n++)for(let l=0;l<e[n].length;l++){const s=t[e[n][l]-1];z(s,l,n)}t[t.length-1].style.opacity="0"},z=(e,t,n)=>{e.style.transform=`translate3D(${100*t}%, ${100*n}%, 0)`},E=(e,t)=>{for(let n=0;n<t.length;n++)for(let l=0;l<t[n].length;l++)if(t[n][l]===e)return{posX:l,posY:n}},q=e=>{let t=document.querySelectorAll("[data-td]");f.push(Number(e)),f.sort(((e,t)=>e-t)),f.length>10&&(f=f.slice(0,10));for(let e=0;e<t.length;e++)f[e]&&(t[e].textContent=f[e]);var n;n=f,localStorage.setItem("saveWinList",JSON.stringify(n))},x=(e,t,n)=>{const l=n[e.posY][e.posX];return n[e.posY][e.posX]=n[t.posY][t.posX],n[t.posY][t.posX]=l,(e=>{const t=e.flat().length,n=e.flat(),l=Array(t).fill(0).map(((e,t)=>t+1));n.join("")===l.join("")&&(()=>{const e=document.querySelector(".winning-message"),t=document.querySelector(".winText");v=document.querySelector(".time").textContent,p=Number(document.querySelector(".move-value").textContent)+1,q(p),t.textContent=`Hooray! You solved the puzzle in ${v} and ${p} moves!`,e.style.display="flex"})()})(n),n},w=e=>{for(let t=0;t<e.length;t++)e[t].disabled=!1};let T=0,L=0;const A=()=>{const e=document.querySelector(".time"),t=e.textContent.split(":");T=Number(t[1]),L=Number(t[0]),T<59?T++:(L++,T=0);let n=`${L.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}`;return J(n),e.textContent=n,n};let N=0;const k=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=document.querySelector(".move-value");return N+=e,t.textContent=N,j(N),N},I=()=>{document.querySelector(".time").textContent="00:00",clearInterval(b),T=0,L=0},C=()=>{const e=document.querySelector(".move-value");N=0,j(N),e.textContent="0"},M=(e,t)=>{const n=e.map((e=>Number(e.dataset.number)));let l=0;if(n.length%2!=0){for(let e=0;e<n.length;e++)if(n[e]!==n.length)for(let t=e+1;t<n.length;t++)n[t]!==n.length&&n[e]>n[t]&&l++}else{for(let e=0;e<n.length;e++)if(n[e]!==n.length)for(let t=e+1;t<n.length;t++)n[t]!==n.length&&n[e]>n[t]&&l++;let e,t=Math.sqrt(n.length);for(let l=0;l<n.length;l++)n[l]===n.length&&(e=Math.ceil((l+1)/t));l+=e}return n.join("")!==t.map((e=>Number(e.dataset.number))).join("")&&l%2==0},Y=e=>{localStorage.setItem("saveMatrix",JSON.stringify(e))},$=()=>JSON.parse(localStorage.getItem("saveMatrix")),X=()=>localStorage.getItem("saveSize"),j=e=>{localStorage.setItem("saveSteps",e)},H=()=>localStorage.getItem("saveSteps"),J=e=>{localStorage.setItem("saveTime",e)},O=()=>localStorage.getItem("saveTime"),B=()=>localStorage.getItem("saveMusic"),W=()=>{b=setInterval(A,1e3)};(new class{init=()=>{const e=document.querySelector("main");r(new c,e),r(new g,e),r(new u,e),r(new o,e),r(new d,e),r(new a,e),r(new m,e)}}).init();const D=document.getElementById("music"),F=function(){let e;return e=!!D.checked,t=e,localStorage.setItem("saveMusic",t),e;var t},{addEvents:G,removeEvents:K}=(()=>{let e=[],t=null;return{removeEvents:()=>{e.forEach((e=>e())),e=[]},addEvents:()=>{let n=R[R.length-1];for(let l=0;l<R.length-1;l++){const s=R[l],r=e=>{for(let e=0;e<R.length-1;e++)R[e].style.background="goldenrod";function l(){ee(e)}e.target.style.background="red",t&&t(),t=()=>n.removeEventListener("mouseup",l),n.addEventListener("mouseup",l)};s.addEventListener("mousedown",r),e.push((()=>s.removeEventListener("mousedown",r)))}}}})(),P=document.querySelector(".puzzle-list");let Q,R=Array.from(document.querySelectorAll(".puzzle-item"));const U=e=>{void 0!==e&&e.target.classList.contains("size-btn")&&_.setAttribute("disabled","disabled");let t=document.querySelector(".active-size");if(void 0!==e&&(t=e.target),t.classList.contains("size-btn")){K(),(e=>{const t=new d;let n=document.querySelector(".active-size");void 0!==e?n=e.target:null!==X()&&(n=document.querySelector(`[data-size="${X()}"]`)),Array.from(document.querySelectorAll(".size-btn")).forEach((e=>e.classList.remove("active-size"))),n.classList.add("active-size");const l=n.dataset.size;var s;s=l,localStorage.setItem("saveSize",s),t.updateElement(l)})(e),R=Array.from(document.querySelectorAll(".puzzle-item")),Q=S(R),null!==$()&&R.length===$().flat().length&&(Q=$());const t=document.querySelector(".move-value"),n=document.querySelector(".time"),l=document.querySelectorAll("[data-td]");if(null!==H()&&(t.textContent=H()),null!==O()&&(n.textContent=O()),null!==B()&&("true"===B()?D.setAttribute("checked","checked"):D.removeAttribute("checked")),null!==h()){const e=h();for(let t=0;t<l.length;t++)l[t].textContent=e[t]}Q.flat().join("")===R.map((e=>Number(e.dataset.number))).join("")&&(C(),I(),_.setAttribute("disabled","disabled")),Y(Q),y(Q,R),(e=>{for(let t=0;t<e.length;t++)e[t].disabled=!0})(R),G()}},V=document.querySelector(".one"),Z=()=>{U();const e=R.slice();for(e.sort((()=>Math.random()-.5));!M(e,R);)e.sort((()=>Math.random()-.5));C(),I(),W(),Q=S(e),y(Q,R),Y(Q),_.setAttribute("disabled","disabled"),w(R)},_=document.querySelector(".two"),ee=e=>{if(!e.target.classList.contains("puzzle-item"))return;const t=Number(e.target.dataset.number),n=Number(R[R.length-1].dataset.number),l=E(t,Q),s=E(n,Q);((e,t)=>{const n=Math.abs(e.posX-t.posX),l=Math.abs(e.posY-t.posY);return!(1!==n&&1!==l||e.posX!==t.posX&&e.posY!==t.posY)})(l,s)&&(F()&&new Audio("./assets/boy.mp3").play(),Q=x(l,s,Q),y(Q,R),k(1),Y(Q))};U();const te=document.querySelector(".restartButton");document.addEventListener("click",U),V.addEventListener("click",Z),P.addEventListener("click",ee),_.addEventListener("click",(()=>{k(Number(H())),W(),w(R),_.setAttribute("disabled","disabled")})),te.addEventListener("click",(()=>{Z(),document.querySelector(".winning-message").style.display="none"})),D.addEventListener("click",F)})();